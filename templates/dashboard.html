{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block nav_dashboard %}bg-white/15{% endblock %}

{% block content %}
<div class="animate-in">
    <!-- Page Header -->
    <div class="flex items-end justify-between mb-8">
        <div>
            <h1 class="text-3xl font-bold text-gray-900 tracking-tight">Dashboard</h1>
            <p class="text-gray-500 mt-1">Overview of all clients and competitive intelligence activity.</p>
        </div>
        <a href="/clients/new"
            class="flex items-center gap-2 stat-gradient-1 hover:opacity-90 text-white font-semibold px-5 py-2.5 rounded-xl transition shadow-lg shadow-brand-200">
            <span class="material-symbols-outlined text-[18px]">add_circle</span>
            New Client
        </a>
    </div>

    <!-- Stat Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        <div class="stat-gradient-1 rounded-2xl p-5 text-white shadow-lg shadow-brand-200/30 card-hover">
            <div class="flex items-center justify-between mb-3">
                <span class="material-symbols-outlined text-white/70 text-[28px]">group</span>
                <span class="bg-white/20 text-[10px] font-semibold px-2 py-0.5 rounded-full uppercase tracking-wider">Clients</span>
            </div>
            <p class="text-3xl font-bold">{{ clients | length }}</p>
            <p class="text-white/60 text-xs mt-1">Total active clients</p>
        </div>

        <div class="stat-gradient-2 rounded-2xl p-5 text-white shadow-lg shadow-pink-200/30 card-hover">
            <div class="flex items-center justify-between mb-3">
                <span class="material-symbols-outlined text-white/70 text-[28px]">monitoring</span>
                <span class="bg-white/20 text-[10px] font-semibold px-2 py-0.5 rounded-full uppercase tracking-wider">Competitors</span>
            </div>
            <p class="text-3xl font-bold">{{ total_competitors }}</p>
            <p class="text-white/60 text-xs mt-1">Competitors tracked</p>
        </div>

        <div class="stat-gradient-3 rounded-2xl p-5 text-white shadow-lg shadow-orange-200/30 card-hover">
            <div class="flex items-center justify-between mb-3">
                <span class="material-symbols-outlined text-white/70 text-[28px]">query_stats</span>
                <span class="bg-white/20 text-[10px] font-semibold px-2 py-0.5 rounded-full uppercase tracking-wider">Queries</span>
            </div>
            <p class="text-3xl font-bold">{{ total_queries }}</p>
            <p class="text-white/60 text-xs mt-1">Saved queries</p>
        </div>

        <div class="stat-gradient-4 rounded-2xl p-5 text-white shadow-lg shadow-purple-200/30 card-hover">
            <div class="flex items-center justify-between mb-3">
                <span class="material-symbols-outlined text-white/70 text-[28px]">description</span>
                <span class="bg-white/20 text-[10px] font-semibold px-2 py-0.5 rounded-full uppercase tracking-wider">Reports</span>
            </div>
            <p class="text-3xl font-bold">{{ total_reports }}</p>
            <p class="text-white/60 text-xs mt-1">Reports generated</p>
        </div>
    </div>

    {% if clients %}
    <!-- Section Header -->
    <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-semibold text-gray-800">All Clients</h2>
        <span class="text-xs text-gray-400">{{ clients | length }} client{{ 's' if clients | length != 1 }}</span>
    </div>

    <!-- Client Cards -->
    <div class="grid gap-4">
        {% for client in clients %}
        <div class="glass-card rounded-2xl shadow-sm border border-gray-100 overflow-hidden card-hover animate-in" style="animation-delay: {{ loop.index0 * 0.05 }}s">
            <div class="p-6">
                <div class="flex items-start justify-between">
                    <div class="flex items-start gap-4">
                        <!-- Avatar -->
                        <div class="w-12 h-12 stat-gradient-{{ (loop.index0 % 4) + 1 }} rounded-xl flex items-center justify-center flex-shrink-0 shadow-md">
                            <span class="text-white text-lg font-bold">{{ client.name[0] | upper }}</span>
                        </div>
                        <div>
                            <h3 class="text-lg font-bold text-gray-900">{{ client.name }}</h3>
                            <p class="text-sm text-gray-400 mt-0.5">{{ client.website }}</p>
                            <div class="flex flex-wrap gap-2 mt-3">
                                <span class="inline-flex items-center gap-1 bg-brand-50 text-brand-600 px-2.5 py-1 rounded-lg text-xs font-medium">
                                    <span class="material-symbols-outlined text-[14px]">groups</span>
                                    {{ client.competitors | length }} competitor{{ 's' if client.competitors | length != 1 }}
                                </span>
                                <span class="inline-flex items-center gap-1 bg-accent-50 text-accent-500 px-2.5 py-1 rounded-lg text-xs font-medium">
                                    <span class="material-symbols-outlined text-[14px]">search</span>
                                    {{ client.queries | length }} quer{{ 'ies' if client.queries | length != 1 else 'y' }}
                                </span>
                                <span class="inline-flex items-center gap-1 bg-gray-100 text-gray-600 px-2.5 py-1 rounded-lg text-xs font-medium">
                                    {% if client.subscription_tier == '6month' %}6-Month
                                    {% elif client.subscription_tier == '1year' %}1-Year
                                    {% else %}Trial{% endif %}
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <a href="/clients/{{ client.id }}"
                            class="flex items-center gap-1.5 text-sm bg-gray-50 hover:bg-gray-100 text-gray-700 px-4 py-2 rounded-xl transition font-medium border border-gray-200">
                            <span class="material-symbols-outlined text-[16px]">visibility</span>
                            View
                        </a>
                        <a href="/clients/{{ client.id }}/edit"
                            class="flex items-center gap-1.5 text-sm stat-gradient-1 hover:opacity-90 text-white px-4 py-2 rounded-xl transition font-medium shadow-sm">
                            <span class="material-symbols-outlined text-[16px]">edit</span>
                            Edit
                        </a>
                        <form method="POST" action="/clients/{{ client.id }}/delete" class="inline"
                            onsubmit="return confirm('Delete this client and all their data? This cannot be undone.')">
                            <button type="submit"
                                class="flex items-center gap-1.5 text-sm bg-red-50 hover:bg-red-100 text-red-500 px-4 py-2 rounded-xl transition font-medium border border-red-100">
                                <span class="material-symbols-outlined text-[16px]">delete</span>
                                Delete
                            </button>
                        </form>
                    </div>
                </div>

                {% if client.queries %}
                <div class="mt-5 border-t border-gray-100 pt-4">
                    <h4 class="text-[10px] font-semibold text-gray-400 uppercase tracking-widest mb-3">Saved Queries</h4>
                    {% for query in client.queries %}
                    <div class="flex items-center justify-between py-2.5 px-3 rounded-lg {% if loop.index0 % 2 == 0 %}bg-gray-50/50{% endif %}">
                        <div class="flex items-center gap-4 text-sm">
                            <span class="material-symbols-outlined text-gray-300 text-[18px]">travel_explore</span>
                            <span class="text-gray-700 font-medium">{{ query.get_countries() | join(', ') or 'No country' }}</span>
                            <span class="text-gray-300">|</span>
                            <span class="text-gray-500">{{ query.get_keywords() | length }} keywords</span>
                            <span class="text-gray-300">|</span>
                            <span class="text-gray-500 capitalize">{{ query.frequency }}</span>
                            {% if query.auto_run %}
                            <span class="inline-flex items-center gap-1 bg-emerald-50 text-emerald-600 px-2 py-0.5 rounded-full text-xs font-medium border border-emerald-200">
                                <span class="w-1.5 h-1.5 bg-emerald-400 rounded-full"></span>
                                Auto
                            </span>
                            {% endif %}
                        </div>
                        <div class="flex gap-2">
                            <form method="POST" action="/queries/{{ query.id }}/run" class="inline">
                                <button type="submit"
                                    class="flex items-center gap-1 text-xs bg-accent-500 hover:bg-accent-400 text-white px-3 py-1.5 rounded-lg transition font-medium shadow-sm">
                                    <span class="material-symbols-outlined text-[14px]">play_arrow</span>
                                    Run
                                </button>
                            </form>
                            <form method="POST" action="/queries/{{ query.id }}/toggle-auto" class="inline">
                                <button type="submit"
                                    class="flex items-center gap-1 text-xs bg-gray-100 hover:bg-gray-200 text-gray-600 px-3 py-1.5 rounded-lg transition font-medium">
                                    <span class="material-symbols-outlined text-[14px]">{% if query.auto_run %}pause{% else %}schedule{% endif %}</span>
                                    {% if query.auto_run %}Pause{% else %}Enable{% endif %} Auto
                                </button>
                            </form>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>

    {% else %}
    <!-- Empty State -->
    <div class="glass-card rounded-2xl shadow-sm border border-gray-100 p-16 text-center animate-in">
        <div class="w-20 h-20 stat-gradient-1 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg shadow-brand-200/30">
            <span class="material-symbols-outlined text-white text-[36px]">search_insights</span>
        </div>
        <h2 class="text-2xl font-bold text-gray-800 mb-2">No clients yet</h2>
        <p class="text-gray-400 mb-8 max-w-md mx-auto">Add your first client to start tracking competitive intelligence across multiple data sources.</p>
        <a href="/clients/new"
            class="inline-flex items-center gap-2 stat-gradient-1 hover:opacity-90 text-white font-semibold px-8 py-3.5 rounded-xl transition shadow-lg shadow-brand-200/30">
            <span class="material-symbols-outlined text-[18px]">add_circle</span>
            Add First Client
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}
