{% extends "base.html" %}
{% block title %}{{ client.name }}{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto animate-in">
    <!-- Breadcrumb -->
    <a href="/" class="inline-flex items-center gap-1 text-sm text-gray-400 hover:text-brand transition mb-6">
        <span class="material-symbols-outlined text-[16px]">arrow_back</span>
        Back to Dashboard
    </a>

    <!-- Client Header -->
    <div class="glass-card rounded-2xl shadow-sm border border-gray-100 p-6 mb-6">
        <div class="flex items-start justify-between">
            <div class="flex items-start gap-4">
                <div class="w-14 h-14 stat-gradient-1 rounded-2xl flex items-center justify-center shadow-lg shadow-brand-200/30">
                    <span class="text-white text-2xl font-bold">{{ client.name[0] | upper }}</span>
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-gray-900">{{ client.name }}</h1>
                    <p class="text-sm text-gray-400 mt-1">{{ client.website }}</p>
                    <div class="flex items-center gap-3 mt-3">
                        <span class="inline-flex items-center gap-1.5 bg-brand-50 text-brand px-3 py-1 rounded-lg text-xs font-medium">
                            <span class="material-symbols-outlined text-[14px]">person</span>
                            {{ client.contact_name }}
                        </span>
                        <span class="inline-flex items-center gap-1.5 bg-gray-100 text-gray-600 px-3 py-1 rounded-lg text-xs font-medium">
                            <span class="material-symbols-outlined text-[14px]">mail</span>
                            {{ client.contact_email }}
                        </span>
                        <span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-lg text-xs font-medium
                            {% if client.subscription_tier == '1year' %}bg-emerald-50 text-emerald-700
                            {% elif client.subscription_tier == '6month' %}bg-blue-50 text-blue-700
                            {% else %}bg-amber-50 text-amber-700{% endif %}">
                            <span class="material-symbols-outlined text-[14px]">workspace_premium</span>
                            {% if client.subscription_tier == '6month' %}6-Month Sub
                            {% elif client.subscription_tier == '1year' %}1-Year Sub
                            {% else %}Trial{% endif %}
                        </span>
                    </div>
                </div>
            </div>
            <a href="/clients/{{ client.id }}/edit"
                class="flex items-center gap-1.5 text-sm stat-gradient-1 hover:opacity-90 text-white px-4 py-2 rounded-xl transition font-medium shadow-sm">
                <span class="material-symbols-outlined text-[16px]">edit</span>
                Edit Client
            </a>
        </div>

        {% set socials = client.get_social_handles() %}
        {% if socials %}
        <div class="mt-5 pt-4 border-t border-gray-100">
            <span class="text-[10px] font-semibold text-gray-400 uppercase tracking-widest">Social Handles</span>
            <div class="flex flex-wrap gap-2 mt-2">
                {% for s in socials %}
                <span class="inline-flex items-center gap-1.5 bg-purple-50 text-brand text-xs px-3 py-1.5 rounded-lg font-medium">
                    <span class="material-symbols-outlined text-[14px]">
                        {% if s.platform == 'linkedin' %}work{% elif s.platform == 'x' %}tag{% elif s.platform == 'instagram' %}photo_camera{% elif s.platform == 'tiktok' %}music_note{% else %}public{% endif %}
                    </span>
                    {{ s.handle }}
                </span>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Stats Row -->
    <div class="grid grid-cols-3 gap-4 mb-6">
        <div class="glass-card rounded-2xl shadow-sm border border-gray-100 p-5 text-center card-hover">
            <span class="material-symbols-outlined text-brand text-[28px] mb-1">groups</span>
            <p class="text-2xl font-bold text-gray-900">{{ client.competitors | length }}</p>
            <p class="text-xs text-gray-400">Competitors</p>
        </div>
        <div class="glass-card rounded-2xl shadow-sm border border-gray-100 p-5 text-center card-hover">
            <span class="material-symbols-outlined text-accent text-[28px] mb-1">query_stats</span>
            <p class="text-2xl font-bold text-gray-900">{{ client.queries | length }}</p>
            <p class="text-xs text-gray-400">Queries</p>
        </div>
        <div class="glass-card rounded-2xl shadow-sm border border-gray-100 p-5 text-center card-hover">
            <span class="material-symbols-outlined text-emerald-500 text-[28px] mb-1">description</span>
            <p class="text-2xl font-bold text-gray-900">{{ report_count }}</p>
            <p class="text-xs text-gray-400">Reports</p>
        </div>
    </div>

    <!-- Competitors -->
    <div class="glass-card rounded-2xl shadow-sm border border-gray-100 p-6 mb-6">
        <div class="flex items-center gap-2 mb-5">
            <span class="material-symbols-outlined text-brand text-[22px]">groups</span>
            <h2 class="text-lg font-semibold text-gray-800">Competitors ({{ client.competitors | length }})</h2>
        </div>
        {% if client.competitors %}
        <div class="grid gap-3">
            {% for comp in client.competitors %}
            <div class="bg-surface-50 rounded-xl p-4 flex items-start justify-between border border-gray-100 card-hover">
                <div class="flex items-start gap-3">
                    <div class="w-10 h-10 stat-gradient-{{ (loop.index0 % 4) + 1 }} rounded-xl flex items-center justify-center flex-shrink-0">
                        <span class="text-white text-sm font-bold">{{ (comp.name or comp.website)[0] | upper }}</span>
                    </div>
                    <div>
                        <p class="font-semibold text-gray-800">{{ comp.name or 'Unnamed' }}</p>
                        <p class="text-sm text-gray-400">{{ comp.website }}</p>
                        <div class="flex flex-wrap gap-2 mt-2">
                            {% if comp.youtube_url %}
                            <span class="inline-flex items-center gap-1 bg-red-50 text-red-600 px-2 py-0.5 rounded-lg text-xs font-medium">
                                <span class="material-symbols-outlined text-[12px]">play_circle</span>YouTube
                            </span>
                            {% endif %}
                            {% if comp.vimeo_url %}
                            <span class="inline-flex items-center gap-1 bg-blue-50 text-blue-600 px-2 py-0.5 rounded-lg text-xs font-medium">
                                <span class="material-symbols-outlined text-[12px]">videocam</span>Vimeo
                            </span>
                            {% endif %}
                            {% if comp.review_page_url %}
                            <span class="inline-flex items-center gap-1 bg-amber-50 text-amber-600 px-2 py-0.5 rounded-lg text-xs font-medium">
                                <span class="material-symbols-outlined text-[12px]">star</span>Reviews
                            </span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-gray-400 text-sm">No competitors added.</p>
        {% endif %}
    </div>

    <!-- Queries & Reports -->
    <div class="glass-card rounded-2xl shadow-sm border border-gray-100 p-6">
        <div class="flex items-center gap-2 mb-5">
            <span class="material-symbols-outlined text-accent text-[22px]">query_stats</span>
            <h2 class="text-lg font-semibold text-gray-800">Queries & Reports</h2>
        </div>
        {% if client.queries %}
        {% for query in client.queries %}
        <div class="bg-surface-50 rounded-xl p-5 mb-3 border border-gray-100">
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-3 text-sm">
                    <span class="material-symbols-outlined text-brand text-[18px]">travel_explore</span>
                    <span class="font-semibold text-gray-700">{{ query.get_countries() | join(', ') or 'No country set' }}</span>
                    <span class="text-gray-300">|</span>
                    <span class="text-gray-500 capitalize">{{ query.frequency }}</span>
                    {% if query.auto_run %}
                    <span class="inline-flex items-center gap-1 bg-emerald-50 text-emerald-600 px-2 py-0.5 rounded-full text-xs font-medium border border-emerald-200">
                        <span class="w-1.5 h-1.5 bg-emerald-400 rounded-full"></span>
                        Auto-Run
                    </span>
                    {% endif %}
                </div>
                <div class="flex gap-2">
                    <form method="POST" action="/queries/{{ query.id }}/run" class="inline">
                        <button class="flex items-center gap-1 text-xs bg-accent hover:bg-accent/90 text-white px-3 py-1.5 rounded-lg transition font-medium shadow-sm">
                            <span class="material-symbols-outlined text-[14px]">play_arrow</span>
                            Run Now
                        </button>
                    </form>
                    <form method="POST" action="/queries/{{ query.id }}/toggle-auto" class="inline">
                        <button class="flex items-center gap-1 text-xs bg-gray-200 hover:bg-gray-300 text-gray-600 px-3 py-1.5 rounded-lg transition font-medium">
                            <span class="material-symbols-outlined text-[14px]">{% if query.auto_run %}pause{% else %}schedule{% endif %}</span>
                            {% if query.auto_run %}Pause{% else %}Enable{% endif %} Auto
                        </button>
                    </form>
                </div>
            </div>
            <div class="text-xs text-gray-400">
                {{ query.get_keywords() | length }} keywords |
                {% if query.period_start %}{{ query.period_start }} to {{ query.period_end }}{% else %}No period set{% endif %}
            </div>

            {% if query.reports %}
            <div class="mt-4 border-t border-gray-200 pt-3">
                <span class="text-[10px] font-semibold text-gray-400 uppercase tracking-widest">Reports</span>
                {% for report in query.reports %}
                <div class="flex items-center justify-between py-2 text-xs">
                    <span class="text-gray-600">{{ report.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
                    <span class="inline-flex items-center gap-1 px-2.5 py-1 rounded-lg font-medium
                        {% if report.status == 'complete' %}bg-emerald-50 text-emerald-700 border border-emerald-200
                        {% elif report.status == 'running' %}bg-amber-50 text-amber-700 border border-amber-200
                        {% elif report.status == 'failed' %}bg-red-50 text-red-700 border border-red-200
                        {% else %}bg-gray-100 text-gray-500 border border-gray-200{% endif %}">
                        <span class="w-1.5 h-1.5 rounded-full
                            {% if report.status == 'complete' %}bg-emerald-400
                            {% elif report.status == 'running' %}bg-amber-400
                            {% elif report.status == 'failed' %}bg-red-400
                            {% else %}bg-gray-400{% endif %}"></span>
                        {{ report.status | capitalize }}
                    </span>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        {% endfor %}
        {% else %}
        <p class="text-gray-400 text-sm">No queries yet.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
